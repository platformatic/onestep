"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withTimeout = exports.isNotTimeout = exports.isTimeout = exports.timeout = void 0;
const is_promise_1 = require("is-promise");
exports.timeout = Symbol('TIMEOUT');
function isTimeout(value) {
    return value === exports.timeout;
}
exports.isTimeout = isTimeout;
function isNotTimeout(value) {
    return value !== exports.timeout;
}
exports.isNotTimeout = isNotTimeout;
async function withTimeout(fn, { timeoutMilliseconds, onResultAfterTimeout, }, ...args) {
    if (timeoutMilliseconds === Infinity) {
        return await fn(...args);
    }
    return await new Promise((resolve, reject) => {
        const promise = fn(...args);
        if ((0, is_promise_1.default)(promise)) {
            let timedOut = false;
            const t = setTimeout(() => {
                timedOut = true;
                resolve(exports.timeout);
            }, timeoutMilliseconds);
            promise.then((v) => {
                if (timedOut) {
                    if (onResultAfterTimeout)
                        onResultAfterTimeout(v);
                }
                else {
                    clearTimeout(t);
                    resolve(v);
                }
            }, (err) => {
                clearTimeout(t);
                reject(err);
            });
        }
        else {
            resolve(promise);
        }
    });
}
exports.withTimeout = withTimeout;
//# sourceMappingURL=timeout.js.map