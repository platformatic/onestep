'use strict';function cov_m3vzi29jy(){var path="/Users/ivan-tymoshenko/projects/platformatic/onestep/tests/execute.js";var hash="dac862ddc0f564ff4c1092709719dfe1f9c90a3d";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/ivan-tymoshenko/projects/platformatic/onestep/tests/execute.js",statementMap:{"0":{start:{line:3,column:19},end:{line:3,column:32}},"1":{start:{line:4,column:17},end:{line:4,column:32}},"2":{start:{line:5,column:28},end:{line:5,column:50}},"3":{start:{line:11,column:4},end:{line:11,column:26}},"4":{start:{line:13,column:23},end:{line:21,column:1}},"5":{start:{line:24,column:26},end:{line:24,column:53}},"6":{start:{line:25,column:26},end:{line:25,column:52}},"7":{start:{line:26,column:33},end:{line:26,column:48}},"8":{start:{line:28,column:2},end:{line:30,column:3}},"9":{start:{line:29,column:4},end:{line:29,column:69}},"10":{start:{line:32,column:21},end:{line:32,column:25}},"11":{start:{line:34,column:2},end:{line:44,column:3}},"12":{start:{line:35,column:23},end:{line:35,column:67}},"13":{start:{line:36,column:4},end:{line:36,column:63}},"14":{start:{line:37,column:27},end:{line:37,column:74}},"15":{start:{line:38,column:4},end:{line:38,column:61}},"16":{start:{line:40,column:4},end:{line:40,column:40}},"17":{start:{line:41,column:4},end:{line:41,column:84}},"18":{start:{line:43,column:4},end:{line:43,column:49}},"19":{start:{line:46,column:2},end:{line:53,column:3}},"20":{start:{line:47,column:26},end:{line:47,column:49}},"21":{start:{line:48,column:4},end:{line:48,column:25}},"22":{start:{line:50,column:4},end:{line:52,column:5}},"23":{start:{line:51,column:6},end:{line:51,column:49}},"24":{start:{line:56,column:0},end:{line:56,column:5}}},fnMap:{"0":{name:"run",decl:{start:{line:23,column:15},end:{line:23,column:18}},loc:{start:{line:23,column:22},end:{line:54,column:1}},line:23}},branchMap:{"0":{loc:{start:{line:25,column:26},end:{line:25,column:52}},type:"binary-expr",locations:[{start:{line:25,column:26},end:{line:25,column:41}},{start:{line:25,column:45},end:{line:25,column:52}}],line:25},"1":{loc:{start:{line:28,column:2},end:{line:30,column:3}},type:"if",locations:[{start:{line:28,column:2},end:{line:30,column:3}},{start:{line:28,column:2},end:{line:30,column:3}}],line:28},"2":{loc:{start:{line:34,column:2},end:{line:44,column:3}},type:"if",locations:[{start:{line:34,column:2},end:{line:44,column:3}},{start:{line:34,column:2},end:{line:44,column:3}}],line:34},"3":{loc:{start:{line:50,column:4},end:{line:52,column:5}},type:"if",locations:[{start:{line:50,column:4},end:{line:52,column:5}},{start:{line:50,column:4},end:{line:52,column:5}}],line:50}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"dac862ddc0f564ff4c1092709719dfe1f9c90a3d"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_m3vzi29jy=function(){return actualCoverage;};}return actualCoverage;}cov_m3vzi29jy();const{tmpdir}=(cov_m3vzi29jy().s[0]++,require('os'));const{join}=(cov_m3vzi29jy().s[1]++,require('path'));const{mkdtemp,cp,rm}=(cov_m3vzi29jy().s[2]++,require('fs/promises'));const{createRepository,setEnvVariable,setInputParam}=(cov_m3vzi29jy().s[3]++,require('./helper.js'));const defaultEnvVars=(cov_m3vzi29jy().s[4]++,{GITHUB_WORKSPACE:'',STEVE_SERVER_URL:'http://localhost:3042',HARRY_SERVER_URL:'http://localhost:3043',INPUT_PLATFORMATIC_API_KEY:'1234',INPUT_GITHUB_TOKEN:'test'});async function run(){cov_m3vzi29jy().f[0]++;const setupRepository=(cov_m3vzi29jy().s[5]++,process.argv[2]!=='false');const testProjectName=(cov_m3vzi29jy().s[6]++,(cov_m3vzi29jy().b[0][0]++,process.argv[3])||(cov_m3vzi29jy().b[0][1]++,'basic'));const platformaticConfigPath=(cov_m3vzi29jy().s[7]++,process.argv[4]);cov_m3vzi29jy().s[8]++;if(platformaticConfigPath!==undefined){cov_m3vzi29jy().b[1][0]++;cov_m3vzi29jy().s[9]++;setInputParam('platformatic_config_path',platformaticConfigPath);}else{cov_m3vzi29jy().b[1][1]++;}let actionFolder=(cov_m3vzi29jy().s[10]++,null);cov_m3vzi29jy().s[11]++;if(setupRepository){cov_m3vzi29jy().b[2][0]++;const fixtureDir=(cov_m3vzi29jy().s[12]++,join(__dirname,'fixtures',testProjectName));cov_m3vzi29jy().s[13]++;actionFolder=await mkdtemp(join(tmpdir(),'action_env_'));const repositoryPath=(cov_m3vzi29jy().s[14]++,await mkdtemp(join(actionFolder,'repository')));cov_m3vzi29jy().s[15]++;await cp(fixtureDir,repositoryPath,{recursive:true});cov_m3vzi29jy().s[16]++;await createRepository(actionFolder);cov_m3vzi29jy().s[17]++;Object.assign(process.env,defaultEnvVars,{GITHUB_WORKSPACE:repositoryPath});cov_m3vzi29jy().s[18]++;setEnvVariable('PLT_ENV_VARIABLE3','value3');}else{cov_m3vzi29jy().b[2][1]++;}cov_m3vzi29jy().s[19]++;try{const executeAction=(cov_m3vzi29jy().s[20]++,require('../action.js'));cov_m3vzi29jy().s[21]++;await executeAction();}finally{cov_m3vzi29jy().s[22]++;if(actionFolder!==null){cov_m3vzi29jy().b[3][0]++;cov_m3vzi29jy().s[23]++;await rm(actionFolder,{recursive:true});}else{cov_m3vzi29jy().b[3][1]++;}}}cov_m3vzi29jy().s[24]++;run();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ0bXBkaXIiLCJyZXF1aXJlIiwiam9pbiIsIm1rZHRlbXAiLCJjcCIsInJtIiwiY3JlYXRlUmVwb3NpdG9yeSIsInNldEVudlZhcmlhYmxlIiwic2V0SW5wdXRQYXJhbSIsImRlZmF1bHRFbnZWYXJzIiwiR0lUSFVCX1dPUktTUEFDRSIsIlNURVZFX1NFUlZFUl9VUkwiLCJIQVJSWV9TRVJWRVJfVVJMIiwiSU5QVVRfUExBVEZPUk1BVElDX0FQSV9LRVkiLCJJTlBVVF9HSVRIVUJfVE9LRU4iLCJydW4iLCJzZXR1cFJlcG9zaXRvcnkiLCJwcm9jZXNzIiwiYXJndiIsInRlc3RQcm9qZWN0TmFtZSIsInBsYXRmb3JtYXRpY0NvbmZpZ1BhdGgiLCJ1bmRlZmluZWQiLCJhY3Rpb25Gb2xkZXIiLCJmaXh0dXJlRGlyIiwiX19kaXJuYW1lIiwicmVwb3NpdG9yeVBhdGgiLCJyZWN1cnNpdmUiLCJPYmplY3QiLCJhc3NpZ24iLCJlbnYiLCJleGVjdXRlQWN0aW9uIl0sInNvdXJjZXMiOlsiZXhlY3V0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcblxuY29uc3QgeyB0bXBkaXIgfSA9IHJlcXVpcmUoJ29zJylcbmNvbnN0IHsgam9pbiB9ID0gcmVxdWlyZSgncGF0aCcpXG5jb25zdCB7IG1rZHRlbXAsIGNwLCBybSB9ID0gcmVxdWlyZSgnZnMvcHJvbWlzZXMnKVxuXG5jb25zdCB7XG4gIGNyZWF0ZVJlcG9zaXRvcnksXG4gIHNldEVudlZhcmlhYmxlLFxuICBzZXRJbnB1dFBhcmFtXG59ID0gcmVxdWlyZSgnLi9oZWxwZXIuanMnKVxuXG5jb25zdCBkZWZhdWx0RW52VmFycyA9IHtcbiAgR0lUSFVCX1dPUktTUEFDRTogJycsXG5cbiAgU1RFVkVfU0VSVkVSX1VSTDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzA0MicsXG4gIEhBUlJZX1NFUlZFUl9VUkw6ICdodHRwOi8vbG9jYWxob3N0OjMwNDMnLFxuXG4gIElOUFVUX1BMQVRGT1JNQVRJQ19BUElfS0VZOiAnMTIzNCcsXG4gIElOUFVUX0dJVEhVQl9UT0tFTjogJ3Rlc3QnXG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJ1biAoKSB7XG4gIGNvbnN0IHNldHVwUmVwb3NpdG9yeSA9IHByb2Nlc3MuYXJndlsyXSAhPT0gJ2ZhbHNlJ1xuICBjb25zdCB0ZXN0UHJvamVjdE5hbWUgPSBwcm9jZXNzLmFyZ3ZbM10gfHwgJ2Jhc2ljJ1xuICBjb25zdCBwbGF0Zm9ybWF0aWNDb25maWdQYXRoID0gcHJvY2Vzcy5hcmd2WzRdXG5cbiAgaWYgKHBsYXRmb3JtYXRpY0NvbmZpZ1BhdGggIT09IHVuZGVmaW5lZCkge1xuICAgIHNldElucHV0UGFyYW0oJ3BsYXRmb3JtYXRpY19jb25maWdfcGF0aCcsIHBsYXRmb3JtYXRpY0NvbmZpZ1BhdGgpXG4gIH1cblxuICBsZXQgYWN0aW9uRm9sZGVyID0gbnVsbFxuXG4gIGlmIChzZXR1cFJlcG9zaXRvcnkpIHtcbiAgICBjb25zdCBmaXh0dXJlRGlyID0gam9pbihfX2Rpcm5hbWUsICdmaXh0dXJlcycsIHRlc3RQcm9qZWN0TmFtZSlcbiAgICBhY3Rpb25Gb2xkZXIgPSBhd2FpdCBta2R0ZW1wKGpvaW4odG1wZGlyKCksICdhY3Rpb25fZW52XycpKVxuICAgIGNvbnN0IHJlcG9zaXRvcnlQYXRoID0gYXdhaXQgbWtkdGVtcChqb2luKGFjdGlvbkZvbGRlciwgJ3JlcG9zaXRvcnknKSlcbiAgICBhd2FpdCBjcChmaXh0dXJlRGlyLCByZXBvc2l0b3J5UGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSlcblxuICAgIGF3YWl0IGNyZWF0ZVJlcG9zaXRvcnkoYWN0aW9uRm9sZGVyKVxuICAgIE9iamVjdC5hc3NpZ24ocHJvY2Vzcy5lbnYsIGRlZmF1bHRFbnZWYXJzLCB7IEdJVEhVQl9XT1JLU1BBQ0U6IHJlcG9zaXRvcnlQYXRoIH0pXG5cbiAgICBzZXRFbnZWYXJpYWJsZSgnUExUX0VOVl9WQVJJQUJMRTMnLCAndmFsdWUzJylcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgZXhlY3V0ZUFjdGlvbiA9IHJlcXVpcmUoJy4uL2FjdGlvbi5qcycpXG4gICAgYXdhaXQgZXhlY3V0ZUFjdGlvbigpXG4gIH0gZmluYWxseSB7XG4gICAgaWYgKGFjdGlvbkZvbGRlciAhPT0gbnVsbCkge1xuICAgICAgYXdhaXQgcm0oYWN0aW9uRm9sZGVyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KVxuICAgIH1cbiAgfVxufVxuXG5ydW4oKVxuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLG9rR0FlQTtBQUFBLHlGQWJaLEtBQU0sQ0FBRUEsTUFBTyxDQUFDLHlCQUFHQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQ2hDLEtBQU0sQ0FBRUMsSUFBSyxDQUFDLHlCQUFHRCxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQ2hDLEtBQU0sQ0FBRUUsT0FBTyxDQUFFQyxFQUFFLENBQUVDLEVBQUcsQ0FBQyx5QkFBR0osT0FBTyxDQUFDLGFBQWEsQ0FBQyxFQUVsRCxLQUFNLENBQ0pLLGdCQUFnQixDQUNoQkMsY0FBYyxDQUNkQyxhQUNGLENBQUMseUJBQUdQLE9BQU8sQ0FBQyxhQUFhLENBQUMsRUFFMUIsS0FBTVEsZUFBYyx5QkFBRyxDQUNyQkMsZ0JBQWdCLENBQUUsRUFBRSxDQUVwQkMsZ0JBQWdCLENBQUUsdUJBQXVCLENBQ3pDQyxnQkFBZ0IsQ0FBRSx1QkFBdUIsQ0FFekNDLDBCQUEwQixDQUFFLE1BQU0sQ0FDbENDLGtCQUFrQixDQUFFLE1BQ3RCLENBQUMsRUFFRCxjQUFlQyxJQUFHLEVBQUksd0JBQ3BCLEtBQU1DLGdCQUFlLHlCQUFHQyxPQUFPLENBQUNDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBSyxPQUFPLEVBQ25ELEtBQU1DLGdCQUFlLHlCQUFHLDJCQUFBRixPQUFPLENBQUNDLElBQUksQ0FBQyxDQUFDLENBQUMsOEJBQUksT0FBTyxHQUNsRCxLQUFNRSx1QkFBc0IseUJBQUdILE9BQU8sQ0FBQ0MsSUFBSSxDQUFDLENBQUMsQ0FBQyx5QkFFOUMsR0FBSUUsc0JBQXNCLEdBQUtDLFNBQVMsQ0FBRSxrREFDeENiLGFBQWEsQ0FBQywwQkFBMEIsQ0FBRVksc0JBQXNCLENBQUMsQ0FDbkUsQ0FBQyxnQ0FFRCxHQUFJRSxhQUFZLDBCQUFHLElBQUksMEJBRXZCLEdBQUlOLGVBQWUsQ0FBRSwyQkFDbkIsS0FBTU8sV0FBVSwwQkFBR3JCLElBQUksQ0FBQ3NCLFNBQVMsQ0FBRSxVQUFVLENBQUVMLGVBQWUsQ0FBQywwQkFDL0RHLFlBQVksQ0FBRyxLQUFNbkIsUUFBTyxDQUFDRCxJQUFJLENBQUNGLE1BQU0sRUFBRSxDQUFFLGFBQWEsQ0FBQyxDQUFDLENBQzNELEtBQU15QixlQUFjLDBCQUFHLEtBQU10QixRQUFPLENBQUNELElBQUksQ0FBQ29CLFlBQVksQ0FBRSxZQUFZLENBQUMsQ0FBQywwQkFDdEUsS0FBTWxCLEdBQUUsQ0FBQ21CLFVBQVUsQ0FBRUUsY0FBYyxDQUFFLENBQUVDLFNBQVMsQ0FBRSxJQUFLLENBQUMsQ0FBQyx5QkFFekQsS0FBTXBCLGlCQUFnQixDQUFDZ0IsWUFBWSxDQUFDLHlCQUNwQ0ssTUFBTSxDQUFDQyxNQUFNLENBQUNYLE9BQU8sQ0FBQ1ksR0FBRyxDQUFFcEIsY0FBYyxDQUFFLENBQUVDLGdCQUFnQixDQUFFZSxjQUFlLENBQUMsQ0FBQyx5QkFFaEZsQixjQUFjLENBQUMsbUJBQW1CLENBQUUsUUFBUSxDQUFDLENBQy9DLENBQUMsd0RBRUQsR0FBSSxDQUNGLEtBQU11QixjQUFhLDBCQUFHN0IsT0FBTyxDQUFDLGNBQWMsQ0FBQywwQkFDN0MsS0FBTTZCLGNBQWEsRUFBRSxDQUN2QixDQUFDLE9BQVMseUJBQ1IsR0FBSVIsWUFBWSxHQUFLLElBQUksQ0FBRSxtREFDekIsS0FBTWpCLEdBQUUsQ0FBQ2lCLFlBQVksQ0FBRSxDQUFFSSxTQUFTLENBQUUsSUFBSyxDQUFDLENBQUMsQ0FDN0MsQ0FBQyxnQ0FDSCxDQUNGLENBQUMsd0JBRURYLEdBQUcsRUFBRSJ9