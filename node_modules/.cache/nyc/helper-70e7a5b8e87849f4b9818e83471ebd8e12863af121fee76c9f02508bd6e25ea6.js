'use strict';function cov_vwieuvxrz(){var path="/Users/ivan-tymoshenko/projects/platformatic/onestep/tests/helper.js";var hash="d932945cf067da8068534465c43aadc4eedb4a69";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/ivan-tymoshenko/projects/platformatic/onestep/tests/helper.js",statementMap:{"0":{start:{line:3,column:17},end:{line:3,column:32}},"1":{start:{line:4,column:22},end:{line:4,column:44}},"2":{start:{line:6,column:16},end:{line:6,column:34}},"3":{start:{line:7,column:13},end:{line:7,column:28}},"4":{start:{line:10,column:16},end:{line:10,column:61}},"5":{start:{line:11,column:25},end:{line:11,column:67}},"6":{start:{line:13,column:19},end:{line:13,column:61}},"7":{start:{line:14,column:18},end:{line:14,column:73}},"8":{start:{line:16,column:18},end:{line:35,column:3}},"9":{start:{line:37,column:32},end:{line:37,column:71}},"10":{start:{line:38,column:2},end:{line:38,column:65}},"11":{start:{line:39,column:2},end:{line:39,column:55}},"12":{start:{line:41,column:2},end:{line:41,column:58}},"13":{start:{line:45,column:2},end:{line:47,column:19}},"14":{start:{line:49,column:2},end:{line:51,column:19}},"15":{start:{line:53,column:2},end:{line:71,column:6}},"16":{start:{line:75,column:23},end:{line:75,column:55}},"17":{start:{line:77,column:2},end:{line:85,column:4}},"18":{start:{line:78,column:33},end:{line:78,column:75}},"19":{start:{line:79,column:4},end:{line:79,column:46}},"20":{start:{line:81,column:4},end:{line:84,column:5}},"21":{start:{line:87,column:2},end:{line:92,column:4}},"22":{start:{line:88,column:37},end:{line:88,column:83}},"23":{start:{line:89,column:4},end:{line:89,column:50}},"24":{start:{line:91,column:4},end:{line:91,column:43}},"25":{start:{line:94,column:2},end:{line:96,column:4}},"26":{start:{line:95,column:4},end:{line:95,column:30}},"27":{start:{line:97,column:2},end:{line:97,column:43}},"28":{start:{line:98,column:2},end:{line:98,column:21}},"29":{start:{line:102,column:16},end:{line:102,column:48}},"30":{start:{line:104,column:2},end:{line:108,column:3}},"31":{start:{line:107,column:32},end:{line:107,column:38}},"32":{start:{line:110,column:2},end:{line:112,column:4}},"33":{start:{line:111,column:4},end:{line:111,column:40}},"34":{start:{line:114,column:2},end:{line:116,column:4}},"35":{start:{line:115,column:4},end:{line:115,column:23}},"36":{start:{line:117,column:2},end:{line:117,column:36}},"37":{start:{line:118,column:2},end:{line:118,column:14}},"38":{start:{line:122,column:18},end:{line:122,column:50}},"39":{start:{line:124,column:2},end:{line:126,column:4}},"40":{start:{line:125,column:4},end:{line:125,column:34}},"41":{start:{line:128,column:2},end:{line:130,column:4}},"42":{start:{line:129,column:4},end:{line:129,column:25}},"43":{start:{line:131,column:2},end:{line:131,column:38}},"44":{start:{line:132,column:2},end:{line:132,column:16}},"45":{start:{line:135,column:0},end:{line:141,column:1}}},fnMap:{"0":{name:"createRepository",decl:{start:{line:9,column:15},end:{line:9,column:31}},loc:{start:{line:9,column:71},end:{line:42,column:1}},line:9},"1":{name:"startGithubApi",decl:{start:{line:44,column:9},end:{line:44,column:23}},loc:{start:{line:44,column:67},end:{line:72,column:1}},line:44},"2":{name:"startControlPanel",decl:{start:{line:74,column:15},end:{line:74,column:32}},loc:{start:{line:74,column:51},end:{line:99,column:1}},line:74},"3":{name:"(anonymous_3)",decl:{start:{line:77,column:32},end:{line:77,column:33}},loc:{start:{line:77,column:58},end:{line:85,column:3}},line:77},"4":{name:"(anonymous_4)",decl:{start:{line:78,column:66},end:{line:78,column:67}},loc:{start:{line:78,column:72},end:{line:78,column:74}},line:78},"5":{name:"(anonymous_5)",decl:{start:{line:87,column:53},end:{line:87,column:54}},loc:{start:{line:87,column:79},end:{line:92,column:3}},line:87},"6":{name:"(anonymous_6)",decl:{start:{line:88,column:74},end:{line:88,column:75}},loc:{start:{line:88,column:80},end:{line:88,column:82}},line:88},"7":{name:"(anonymous_7)",decl:{start:{line:94,column:13},end:{line:94,column:14}},loc:{start:{line:94,column:25},end:{line:96,column:3}},line:94},"8":{name:"startHarry",decl:{start:{line:101,column:15},end:{line:101,column:25}},loc:{start:{line:101,column:57},end:{line:119,column:1}},line:101},"9":{name:"(anonymous_9)",decl:{start:{line:101,column:47},end:{line:101,column:48}},loc:{start:{line:101,column:53},end:{line:101,column:55}},line:101},"10":{name:"(anonymous_10)",decl:{start:{line:107,column:4},end:{line:107,column:5}},loc:{start:{line:107,column:32},end:{line:107,column:38}},line:107},"11":{name:"(anonymous_11)",decl:{start:{line:110,column:23},end:{line:110,column:24}},loc:{start:{line:110,column:49},end:{line:112,column:3}},line:110},"12":{name:"(anonymous_12)",decl:{start:{line:114,column:13},end:{line:114,column:14}},loc:{start:{line:114,column:25},end:{line:116,column:3}},line:114},"13":{name:"startMachine",decl:{start:{line:121,column:15},end:{line:121,column:27}},loc:{start:{line:121,column:42},end:{line:133,column:1}},line:121},"14":{name:"(anonymous_14)",decl:{start:{line:124,column:19},end:{line:124,column:20}},loc:{start:{line:124,column:45},end:{line:126,column:3}},line:124},"15":{name:"(anonymous_15)",decl:{start:{line:128,column:13},end:{line:128,column:14}},loc:{start:{line:128,column:25},end:{line:130,column:3}},line:128}},branchMap:{"0":{loc:{start:{line:9,column:47},end:{line:9,column:69}},type:"default-arg",locations:[{start:{line:9,column:67},end:{line:9,column:69}}],line:9},"1":{loc:{start:{line:10,column:16},end:{line:10,column:61}},type:"binary-expr",locations:[{start:{line:10,column:16},end:{line:10,column:39}},{start:{line:10,column:43},end:{line:10,column:61}}],line:10},"2":{loc:{start:{line:11,column:25},end:{line:11,column:67}},type:"binary-expr",locations:[{start:{line:11,column:25},end:{line:11,column:47}},{start:{line:11,column:51},end:{line:11,column:67}}],line:11},"3":{loc:{start:{line:13,column:19},end:{line:13,column:61}},type:"binary-expr",locations:[{start:{line:13,column:19},end:{line:13,column:56}},{start:{line:13,column:60},end:{line:13,column:61}}],line:13},"4":{loc:{start:{line:14,column:18},end:{line:14,column:73}},type:"binary-expr",locations:[{start:{line:14,column:18},end:{line:14,column:54}},{start:{line:14,column:58},end:{line:14,column:73}}],line:14},"5":{loc:{start:{line:74,column:37},end:{line:74,column:49}},type:"default-arg",locations:[{start:{line:74,column:47},end:{line:74,column:49}}],line:74},"6":{loc:{start:{line:78,column:33},end:{line:78,column:75}},type:"binary-expr",locations:[{start:{line:78,column:33},end:{line:78,column:61}},{start:{line:78,column:66},end:{line:78,column:74}}],line:78},"7":{loc:{start:{line:88,column:37},end:{line:88,column:83}},type:"binary-expr",locations:[{start:{line:88,column:37},end:{line:88,column:69}},{start:{line:88,column:74},end:{line:88,column:82}}],line:88},"8":{loc:{start:{line:101,column:30},end:{line:101,column:55}},type:"default-arg",locations:[{start:{line:101,column:47},end:{line:101,column:55}}],line:101}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},b:{"0":[0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0],"6":[0,0],"7":[0,0],"8":[0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"d932945cf067da8068534465c43aadc4eedb4a69"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_vwieuvxrz=function(){return actualCoverage;};}return actualCoverage;}cov_vwieuvxrz();const{join}=(cov_vwieuvxrz().s[0]++,require('path'));const{writeFile}=(cov_vwieuvxrz().s[1]++,require('fs/promises'));const fastify=(cov_vwieuvxrz().s[2]++,require('fastify'));const nock=(cov_vwieuvxrz().s[3]++,require('nock'));async function createRepository(actionFolder,repositoryOptions=(cov_vwieuvxrz().b[0][0]++,{})){cov_vwieuvxrz().f[0]++;const owner=(cov_vwieuvxrz().s[4]++,(cov_vwieuvxrz().b[1][0]++,repositoryOptions.owner)||(cov_vwieuvxrz().b[1][1]++,'test-github-user'));const repositoryName=(cov_vwieuvxrz().s[5]++,(cov_vwieuvxrz().b[2][0]++,repositoryOptions.name)||(cov_vwieuvxrz().b[2][1]++,'test-repo-name'));const prNumber=(cov_vwieuvxrz().s[6]++,(cov_vwieuvxrz().b[3][0]++,repositoryOptions.pullRequest?.number)||(cov_vwieuvxrz().b[3][1]++,1));const prTitle=(cov_vwieuvxrz().s[7]++,(cov_vwieuvxrz().b[4][0]++,repositoryOptions.pullRequest?.title)||(cov_vwieuvxrz().b[4][1]++,'Test PR title'));const payload=(cov_vwieuvxrz().s[8]++,{pull_request:{number:prNumber,base:{repo:{owner:{login:owner},name:repositoryName}}},repository:{name:repositoryName,html_url:`https://github.com/${owner}/${repositoryName}`,owner:{login:owner}}});const githubEventConfigPath=(cov_vwieuvxrz().s[9]++,join(actionFolder,'github_event.json'));cov_vwieuvxrz().s[10]++;await writeFile(githubEventConfigPath,JSON.stringify(payload));cov_vwieuvxrz().s[11]++;process.env.GITHUB_EVENT_PATH=githubEventConfigPath;cov_vwieuvxrz().s[12]++;startGithubApi(owner,repositoryName,prNumber,prTitle);}function startGithubApi(owner,repositoryName,prNumber,prTitle){cov_vwieuvxrz().f[1]++;cov_vwieuvxrz().s[13]++;nock('https://api.github.com').post(`/repos/${owner}/${repositoryName}/issues/${prNumber}/comments`).reply(200,{});cov_vwieuvxrz().s[14]++;nock('https://api.github.com').get(`/repos/${owner}/${repositoryName}/issues/${prNumber}/comments`).reply(200,[]);cov_vwieuvxrz().s[15]++;nock('https://api.github.com').get(`/repos/${owner}/${repositoryName}/pulls/${prNumber}`).reply(200,{head:{sha:'1234',ref:'test',repo:{full_name:`${owner}/${repositoryName}`,html_url:`https://github.com/${owner}/${repositoryName}`},user:{login:owner}},title:prTitle,number:prNumber,additions:1,deletions:1});}async function startControlPanel(t,options=(cov_vwieuvxrz().b[5][0]++,{})){cov_vwieuvxrz().f[2]++;const controlPanel=(cov_vwieuvxrz().s[16]++,fastify({keepAliveTimeout:1}));cov_vwieuvxrz().s[17]++;controlPanel.post('/bundles',async(request,reply)=>{cov_vwieuvxrz().f[3]++;const createBundleCallback=(cov_vwieuvxrz().s[18]++,(cov_vwieuvxrz().b[6][0]++,options.createBundleCallback)||(cov_vwieuvxrz().b[6][1]++,()=>{cov_vwieuvxrz().f[4]++;}));cov_vwieuvxrz().s[19]++;await createBundleCallback(request,reply);cov_vwieuvxrz().s[20]++;return{bundleId:'default-bundle-id',uploadToken:'default-upload-token'};});cov_vwieuvxrz().s[21]++;controlPanel.post('/bundles/:bundleId/deployment',async(request,reply)=>{cov_vwieuvxrz().f[5]++;const createDeploymentCallback=(cov_vwieuvxrz().s[22]++,(cov_vwieuvxrz().b[7][0]++,options.createDeploymentCallback)||(cov_vwieuvxrz().b[7][1]++,()=>{cov_vwieuvxrz().f[6]++;}));cov_vwieuvxrz().s[23]++;await createDeploymentCallback(request,reply);cov_vwieuvxrz().s[24]++;return{url:'http://localhost:3044'};});cov_vwieuvxrz().s[25]++;t.teardown(async()=>{cov_vwieuvxrz().f[7]++;cov_vwieuvxrz().s[26]++;await controlPanel.close();});cov_vwieuvxrz().s[27]++;await controlPanel.listen({port:3042});cov_vwieuvxrz().s[28]++;return controlPanel;}async function startHarry(t,uploadCallback=(cov_vwieuvxrz().b[8][0]++,()=>{cov_vwieuvxrz().f[9]++;})){cov_vwieuvxrz().f[8]++;const harry=(cov_vwieuvxrz().s[29]++,fastify({keepAliveTimeout:1}));cov_vwieuvxrz().s[30]++;harry.addContentTypeParser('application/x-tar',{bodyLimit:1024*1024*1024},(request,payload,done)=>{cov_vwieuvxrz().f[10]++;cov_vwieuvxrz().s[31]++;return done();});cov_vwieuvxrz().s[32]++;harry.put('/upload',async(request,reply)=>{cov_vwieuvxrz().f[11]++;cov_vwieuvxrz().s[33]++;await uploadCallback(request,reply);});cov_vwieuvxrz().s[34]++;t.teardown(async()=>{cov_vwieuvxrz().f[12]++;cov_vwieuvxrz().s[35]++;await harry.close();});cov_vwieuvxrz().s[36]++;await harry.listen({port:3043});cov_vwieuvxrz().s[37]++;return harry;}async function startMachine(t,callback){cov_vwieuvxrz().f[13]++;const machine=(cov_vwieuvxrz().s[38]++,fastify({keepAliveTimeout:1}));cov_vwieuvxrz().s[39]++;machine.get('/',async(request,reply)=>{cov_vwieuvxrz().f[14]++;cov_vwieuvxrz().s[40]++;await callback(request,reply);});cov_vwieuvxrz().s[41]++;t.teardown(async()=>{cov_vwieuvxrz().f[15]++;cov_vwieuvxrz().s[42]++;await machine.close();});cov_vwieuvxrz().s[43]++;await machine.listen({port:3044});cov_vwieuvxrz().s[44]++;return machine;}cov_vwieuvxrz().s[45]++;module.exports={createRepository,startControlPanel,startHarry,startMachine,startGithubApi};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqb2luIiwicmVxdWlyZSIsIndyaXRlRmlsZSIsImZhc3RpZnkiLCJub2NrIiwiY3JlYXRlUmVwb3NpdG9yeSIsImFjdGlvbkZvbGRlciIsInJlcG9zaXRvcnlPcHRpb25zIiwib3duZXIiLCJyZXBvc2l0b3J5TmFtZSIsIm5hbWUiLCJwck51bWJlciIsInB1bGxSZXF1ZXN0IiwibnVtYmVyIiwicHJUaXRsZSIsInRpdGxlIiwicGF5bG9hZCIsInB1bGxfcmVxdWVzdCIsImJhc2UiLCJyZXBvIiwibG9naW4iLCJyZXBvc2l0b3J5IiwiaHRtbF91cmwiLCJnaXRodWJFdmVudENvbmZpZ1BhdGgiLCJKU09OIiwic3RyaW5naWZ5IiwicHJvY2VzcyIsImVudiIsIkdJVEhVQl9FVkVOVF9QQVRIIiwic3RhcnRHaXRodWJBcGkiLCJwb3N0IiwicmVwbHkiLCJnZXQiLCJoZWFkIiwic2hhIiwicmVmIiwiZnVsbF9uYW1lIiwidXNlciIsImFkZGl0aW9ucyIsImRlbGV0aW9ucyIsInN0YXJ0Q29udHJvbFBhbmVsIiwidCIsIm9wdGlvbnMiLCJjb250cm9sUGFuZWwiLCJrZWVwQWxpdmVUaW1lb3V0IiwicmVxdWVzdCIsImNyZWF0ZUJ1bmRsZUNhbGxiYWNrIiwiYnVuZGxlSWQiLCJ1cGxvYWRUb2tlbiIsImNyZWF0ZURlcGxveW1lbnRDYWxsYmFjayIsInVybCIsInRlYXJkb3duIiwiY2xvc2UiLCJsaXN0ZW4iLCJwb3J0Iiwic3RhcnRIYXJyeSIsInVwbG9hZENhbGxiYWNrIiwiaGFycnkiLCJhZGRDb250ZW50VHlwZVBhcnNlciIsImJvZHlMaW1pdCIsImRvbmUiLCJwdXQiLCJzdGFydE1hY2hpbmUiLCJjYWxsYmFjayIsIm1hY2hpbmUiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiaGVscGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0J1xuXG5jb25zdCB7IGpvaW4gfSA9IHJlcXVpcmUoJ3BhdGgnKVxuY29uc3QgeyB3cml0ZUZpbGUgfSA9IHJlcXVpcmUoJ2ZzL3Byb21pc2VzJylcblxuY29uc3QgZmFzdGlmeSA9IHJlcXVpcmUoJ2Zhc3RpZnknKVxuY29uc3Qgbm9jayA9IHJlcXVpcmUoJ25vY2snKVxuXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVSZXBvc2l0b3J5IChhY3Rpb25Gb2xkZXIsIHJlcG9zaXRvcnlPcHRpb25zID0ge30pIHtcbiAgY29uc3Qgb3duZXIgPSByZXBvc2l0b3J5T3B0aW9ucy5vd25lciB8fCAndGVzdC1naXRodWItdXNlcidcbiAgY29uc3QgcmVwb3NpdG9yeU5hbWUgPSByZXBvc2l0b3J5T3B0aW9ucy5uYW1lIHx8ICd0ZXN0LXJlcG8tbmFtZSdcblxuICBjb25zdCBwck51bWJlciA9IHJlcG9zaXRvcnlPcHRpb25zLnB1bGxSZXF1ZXN0Py5udW1iZXIgfHwgMVxuICBjb25zdCBwclRpdGxlID0gcmVwb3NpdG9yeU9wdGlvbnMucHVsbFJlcXVlc3Q/LnRpdGxlIHx8ICdUZXN0IFBSIHRpdGxlJ1xuXG4gIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgcHVsbF9yZXF1ZXN0OiB7XG4gICAgICBudW1iZXI6IHByTnVtYmVyLFxuICAgICAgYmFzZToge1xuICAgICAgICByZXBvOiB7XG4gICAgICAgICAgb3duZXI6IHtcbiAgICAgICAgICAgIGxvZ2luOiBvd25lclxuICAgICAgICAgIH0sXG4gICAgICAgICAgbmFtZTogcmVwb3NpdG9yeU5hbWVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgcmVwb3NpdG9yeToge1xuICAgICAgbmFtZTogcmVwb3NpdG9yeU5hbWUsXG4gICAgICBodG1sX3VybDogYGh0dHBzOi8vZ2l0aHViLmNvbS8ke293bmVyfS8ke3JlcG9zaXRvcnlOYW1lfWAsXG4gICAgICBvd25lcjoge1xuICAgICAgICBsb2dpbjogb3duZXJcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBjb25zdCBnaXRodWJFdmVudENvbmZpZ1BhdGggPSBqb2luKGFjdGlvbkZvbGRlciwgJ2dpdGh1Yl9ldmVudC5qc29uJylcbiAgYXdhaXQgd3JpdGVGaWxlKGdpdGh1YkV2ZW50Q29uZmlnUGF0aCwgSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkpXG4gIHByb2Nlc3MuZW52LkdJVEhVQl9FVkVOVF9QQVRIID0gZ2l0aHViRXZlbnRDb25maWdQYXRoXG5cbiAgc3RhcnRHaXRodWJBcGkob3duZXIsIHJlcG9zaXRvcnlOYW1lLCBwck51bWJlciwgcHJUaXRsZSlcbn1cblxuZnVuY3Rpb24gc3RhcnRHaXRodWJBcGkgKG93bmVyLCByZXBvc2l0b3J5TmFtZSwgcHJOdW1iZXIsIHByVGl0bGUpIHtcbiAgbm9jaygnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbScpXG4gICAgLnBvc3QoYC9yZXBvcy8ke293bmVyfS8ke3JlcG9zaXRvcnlOYW1lfS9pc3N1ZXMvJHtwck51bWJlcn0vY29tbWVudHNgKVxuICAgIC5yZXBseSgyMDAsIHt9KVxuXG4gIG5vY2soJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20nKVxuICAgIC5nZXQoYC9yZXBvcy8ke293bmVyfS8ke3JlcG9zaXRvcnlOYW1lfS9pc3N1ZXMvJHtwck51bWJlcn0vY29tbWVudHNgKVxuICAgIC5yZXBseSgyMDAsIFtdKVxuXG4gIG5vY2soJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20nKVxuICAgIC5nZXQoYC9yZXBvcy8ke293bmVyfS8ke3JlcG9zaXRvcnlOYW1lfS9wdWxscy8ke3ByTnVtYmVyfWApXG4gICAgLnJlcGx5KDIwMCwge1xuICAgICAgaGVhZDoge1xuICAgICAgICBzaGE6ICcxMjM0JyxcbiAgICAgICAgcmVmOiAndGVzdCcsXG4gICAgICAgIHJlcG86IHtcbiAgICAgICAgICBmdWxsX25hbWU6IGAke293bmVyfS8ke3JlcG9zaXRvcnlOYW1lfWAsXG4gICAgICAgICAgaHRtbF91cmw6IGBodHRwczovL2dpdGh1Yi5jb20vJHtvd25lcn0vJHtyZXBvc2l0b3J5TmFtZX1gXG4gICAgICAgIH0sXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBsb2dpbjogb3duZXJcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRpdGxlOiBwclRpdGxlLFxuICAgICAgbnVtYmVyOiBwck51bWJlcixcbiAgICAgIGFkZGl0aW9uczogMSxcbiAgICAgIGRlbGV0aW9uczogMVxuICAgIH0pXG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0Q29udHJvbFBhbmVsICh0LCBvcHRpb25zID0ge30pIHtcbiAgY29uc3QgY29udHJvbFBhbmVsID0gZmFzdGlmeSh7IGtlZXBBbGl2ZVRpbWVvdXQ6IDEgfSlcblxuICBjb250cm9sUGFuZWwucG9zdCgnL2J1bmRsZXMnLCBhc3luYyAocmVxdWVzdCwgcmVwbHkpID0+IHtcbiAgICBjb25zdCBjcmVhdGVCdW5kbGVDYWxsYmFjayA9IG9wdGlvbnMuY3JlYXRlQnVuZGxlQ2FsbGJhY2sgfHwgKCgpID0+IHt9KVxuICAgIGF3YWl0IGNyZWF0ZUJ1bmRsZUNhbGxiYWNrKHJlcXVlc3QsIHJlcGx5KVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGJ1bmRsZUlkOiAnZGVmYXVsdC1idW5kbGUtaWQnLFxuICAgICAgdXBsb2FkVG9rZW46ICdkZWZhdWx0LXVwbG9hZC10b2tlbidcbiAgICB9XG4gIH0pXG5cbiAgY29udHJvbFBhbmVsLnBvc3QoJy9idW5kbGVzLzpidW5kbGVJZC9kZXBsb3ltZW50JywgYXN5bmMgKHJlcXVlc3QsIHJlcGx5KSA9PiB7XG4gICAgY29uc3QgY3JlYXRlRGVwbG95bWVudENhbGxiYWNrID0gb3B0aW9ucy5jcmVhdGVEZXBsb3ltZW50Q2FsbGJhY2sgfHwgKCgpID0+IHt9KVxuICAgIGF3YWl0IGNyZWF0ZURlcGxveW1lbnRDYWxsYmFjayhyZXF1ZXN0LCByZXBseSlcblxuICAgIHJldHVybiB7IHVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MzA0NCcgfVxuICB9KVxuXG4gIHQudGVhcmRvd24oYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGNvbnRyb2xQYW5lbC5jbG9zZSgpXG4gIH0pXG4gIGF3YWl0IGNvbnRyb2xQYW5lbC5saXN0ZW4oeyBwb3J0OiAzMDQyIH0pXG4gIHJldHVybiBjb250cm9sUGFuZWxcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRIYXJyeSAodCwgdXBsb2FkQ2FsbGJhY2sgPSAoKSA9PiB7fSkge1xuICBjb25zdCBoYXJyeSA9IGZhc3RpZnkoeyBrZWVwQWxpdmVUaW1lb3V0OiAxIH0pXG5cbiAgaGFycnkuYWRkQ29udGVudFR5cGVQYXJzZXIoXG4gICAgJ2FwcGxpY2F0aW9uL3gtdGFyJyxcbiAgICB7IGJvZHlMaW1pdDogMTAyNCAqIDEwMjQgKiAxMDI0IH0sXG4gICAgKHJlcXVlc3QsIHBheWxvYWQsIGRvbmUpID0+IGRvbmUoKVxuICApXG5cbiAgaGFycnkucHV0KCcvdXBsb2FkJywgYXN5bmMgKHJlcXVlc3QsIHJlcGx5KSA9PiB7XG4gICAgYXdhaXQgdXBsb2FkQ2FsbGJhY2socmVxdWVzdCwgcmVwbHkpXG4gIH0pXG5cbiAgdC50ZWFyZG93bihhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgaGFycnkuY2xvc2UoKVxuICB9KVxuICBhd2FpdCBoYXJyeS5saXN0ZW4oeyBwb3J0OiAzMDQzIH0pXG4gIHJldHVybiBoYXJyeVxufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydE1hY2hpbmUgKHQsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IG1hY2hpbmUgPSBmYXN0aWZ5KHsga2VlcEFsaXZlVGltZW91dDogMSB9KVxuXG4gIG1hY2hpbmUuZ2V0KCcvJywgYXN5bmMgKHJlcXVlc3QsIHJlcGx5KSA9PiB7XG4gICAgYXdhaXQgY2FsbGJhY2socmVxdWVzdCwgcmVwbHkpXG4gIH0pXG5cbiAgdC50ZWFyZG93bihhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgbWFjaGluZS5jbG9zZSgpXG4gIH0pXG4gIGF3YWl0IG1hY2hpbmUubGlzdGVuKHsgcG9ydDogMzA0NCB9KVxuICByZXR1cm4gbWFjaGluZVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY3JlYXRlUmVwb3NpdG9yeSxcbiAgc3RhcnRDb250cm9sUGFuZWwsXG4gIHN0YXJ0SGFycnksXG4gIHN0YXJ0TWFjaGluZSxcbiAgc3RhcnRHaXRodWJBcGlcbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxxb1BBZUE7QUFBQSx5RkFiWixLQUFNLENBQUVBLElBQUssQ0FBQyx5QkFBR0MsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUNoQyxLQUFNLENBQUVDLFNBQVUsQ0FBQyx5QkFBR0QsT0FBTyxDQUFDLGFBQWEsQ0FBQyxFQUU1QyxLQUFNRSxRQUFPLHlCQUFHRixPQUFPLENBQUMsU0FBUyxDQUFDLEVBQ2xDLEtBQU1HLEtBQUkseUJBQUdILE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFFNUIsY0FBZUksaUJBQWdCLENBQUVDLFlBQVksQ0FBRUMsaUJBQWlCLDRCQUFHLENBQUMsQ0FBQyxFQUFFLHdCQUNyRSxLQUFNQyxNQUFLLHlCQUFHLDJCQUFBRCxpQkFBaUIsQ0FBQ0MsS0FBSyw4QkFBSSxrQkFBa0IsR0FDM0QsS0FBTUMsZUFBYyx5QkFBRywyQkFBQUYsaUJBQWlCLENBQUNHLElBQUksOEJBQUksZ0JBQWdCLEdBRWpFLEtBQU1DLFNBQVEseUJBQUcsMkJBQUFKLGlCQUFpQixDQUFDSyxXQUFXLEVBQUVDLE1BQU0sOEJBQUksQ0FBQyxHQUMzRCxLQUFNQyxRQUFPLHlCQUFHLDJCQUFBUCxpQkFBaUIsQ0FBQ0ssV0FBVyxFQUFFRyxLQUFLLDhCQUFJLGVBQWUsR0FFdkUsS0FBTUMsUUFBTyx5QkFBRyxDQUNkQyxZQUFZLENBQUUsQ0FDWkosTUFBTSxDQUFFRixRQUFRLENBQ2hCTyxJQUFJLENBQUUsQ0FDSkMsSUFBSSxDQUFFLENBQ0pYLEtBQUssQ0FBRSxDQUNMWSxLQUFLLENBQUVaLEtBQ1QsQ0FBQyxDQUNERSxJQUFJLENBQUVELGNBQ1IsQ0FDRixDQUNGLENBQUMsQ0FDRFksVUFBVSxDQUFFLENBQ1ZYLElBQUksQ0FBRUQsY0FBYyxDQUNwQmEsUUFBUSxDQUFHLHNCQUFxQmQsS0FBTSxJQUFHQyxjQUFlLEVBQUMsQ0FDekRELEtBQUssQ0FBRSxD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